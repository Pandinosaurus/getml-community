#!/usr/bin/env sh

command=$(basename $0)
bin_dir=$(dirname -- "$(realpath -- "$0")")

extract_subcommands_doc_partial() {
    partial=""
    for script in "${bin_dir}/getml-"*; do
        if [ -x "$script" ]; then
            subcmd=$(basename "$script" | sed 's/getml-//')
            docstring=$("$script" -h | head -n 1)
            padding_chars=$((10 - ${#subcmd}))
            padding=$(printf "%${padding_chars}s")
            partial="${partial}    ${subcmd}${padding}${docstring}\n"
        fi
    done
    printf "%b" "$partial"
}

show_help() {
    subcommands_doc_partial=$(extract_subcommands_doc_partial)
    cat <<-EOF
		getml utilities

		Usage:
		    ${command} <subcommand> [options]

		Subcommands:
		$subcommands_doc_partial
		    help      Show help (this message)

		Options:
		    -h        Show help (this message)
	EOF
}


subcommand=$1
shift

case $subcommand in
    "" | -h | help)
        show_help
        exit 0
        ;;
    *)
        script="${bin_dir}/getml-${subcommand}"
        if [ -x "$script" ]; then
            "$script" "$@"
            exit 0
        else
            echo "Unrecognized subcommand: $subcommand" >&2
            exit 1
        fi
        ;;
esac
